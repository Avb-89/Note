### -- Remove Unneeded Install Options
get-windowsimage -imagepath c:\hyperv\install.wim					//Командлет Get-WindowsImage получает информацию об образе Windows в файле WIM или VHD, 
																	//imagepath указывает путь к этому файлу
remove-windowsimage -imagepath c:\hyperv\install.wim -index 1		//Удаляет указанный образ тома из WIM-файла с несколькими томами.
																	//-Index<UInt32> - Задает номер индекса образа Windows в WIM- или VHD-файле.
																	//Для VHD-файла индекс должно быть равен 1.

### -- Apply Updates
mkdir c:\offline
mount-windowsimage -imagepath c:\hyperv\install.wim -index 1 -path c:\offline	//Монтирует образ Windows в файле WIM или VHD в каталог на локальном компьютере
																				//Параметр Path указывает местоположение, в котором вы хотите смонтировать образ Windows.
																				//Параметр ImagePath указывает местоположение файла WIM или VHD, 
																				//содержащего образ Windows, который вы хотите установить.
																				//Используйте параметр Index или Name, чтобы указать, какое изображение в файле 
																				//WIM или VHD, который вы хотите установить. Для файла VHD индекс должен быть 1.
add-windowspackage -path c:\offline c:\hyperv\updates							//Добавляет один файл .cab или .msu в образ Windows.

### -- Add Drivers
add-windowsdriver -path c:\offline -driver c:\hyperv\drivers -recurse			//Добавляет драйвер в автономный образ Windows.
																				//Используйте параметр «Путь», чтобы указать местоположение смонтированного 
																				//образа Windows.
																				//Используйте параметр «Драйвер», чтобы указать расположение файла 
																				//драйвера .inf или папку, содержащую один или несколько файлов драйверов .inf.
																				//-Recurse - Включает все подпапки при поиске драйверов для добавления.
### -- Enable Hyper-V Role
get-windowsoptionalfeature -path c:\offline										//Получает информацию о дополнительных функциях в образе Windows.
get-windowsoptionalfeature -path c:\offline | where featurename -like "*hyper*"	//Получает информацию о дополнительных функциях в образе Windows.По фильтру hyper
enable-windowsoptionalfeature -path c:\offline -featurename microsoft-hyper-v -all //Включает функцию образа Windows
																				   //Параметр FeatureName указывает добавляемую функцию. Вы можете указать более 
																				   //одной функции в одном пакете. Отдельные имена функций с запятой.
																				   //-all - Включает все родительские функции указанной функции. Если родительская 
																				   //функция требуется для того, чтобы указанная функция была включена в изображении, 
																				   //All включит родительский элемент и все его зависимости по умолчанию.
### - Save and Dismount
dismount-windowsimage -path c:\offline -save										//Снимает образ Windows из каталога, на который он сопоставляется.
																					//Параметр Path указывает местоположение смонтированного образа Windows.
																					//save - сохраняет все изменения в образе
### -- Configure Networking on Host Machine
netsh interface ip set address name="ethernet0" static 192.168.3.101 255.255.255.0 192.168.3.2 // с помощью утиллиты netch 
																					//устанавливаем нашему интерфейсу - ethernet0 
																					//значения IP-адреса, маски и подсети
net use z: \\192.168.3.100\c$ /user:company\gshields								//В командной строке NET USE используется для подключения и 
																					//отключения от общих сетевых ресурсов 
																					//(дисков) и для вывода сведений о текущих подключениях.

### -- Partition Disks in Preparation for New OS
Diskpart.exe																		//управление дисками, томами и разделами в командной строке Windows
Select disk 0																		//Установка фокуса на объект
Clean																				//Очистка сведений о конфигурации или всех данных на диске.
Convert GPT																			//Преобразование форматов диска.GPT — стандарт формата размещения таблиц разделов на физическом
																					//жестком диске. Он является частью Расширяемого микропрограммного интерфейса 
																					//(англ. Extensible Firmware Interface, EFI) — стандарта, предложенного Intel на смену BIOS
																					//На смену MBR пришла GPT со своими разделами. Одна из причин перехода на UEFI 
																					//- поддержка загрузочных томов больше 2TB
Create partition efi size=100														//Создание тома, раздела или виртуального диска
Format quick FS=FAT32 label="System"												//Форматирование данного тома или раздела. Label - это имя, может быть рандомным
Assign letter="s"																	//Назначение имени или точки подключения выбранному тому, 
																					//в данном случае этому тому присвоено имя "s"
Create partition msr size=128														//Создание тома, раздела или виртуального диска, msr - это аналог gpt
Create partition primary															//Создание тома, раздела или виртуального диска.Эта команда создаст чистый раздел 
																					//RAW на диске
Format quick FS=NTFS label="NanoServer"												//Форматирование данного тома или раздела.
																					//format создаёт пустую файловую систему на одном разделе, 
																					//а clean очищает таблицу разделов, делая недоступными все разделы на диске.
Assign letter="n"																	//Назначение имени или точки подключения выбранному тому
List volume																			//Отображение списка объектов.
Exit																				//Выход

### -- Install New OS
Dism.exe /apply-image /imagefile:z:\hyperv\install.wim /index:1 /applydir:n:\ 

//DISM - это консольная программа для управления образами .wim, с помощью него можно распаковывать (монтировать) файл образа, 
//добавлять в файл образа дополнительные пакеты, интегрировать драйверы, выполнять настройку образа и затем снова упаковывать
// измененный образ в .wim-файл (демонтировать). Для того чтобы не указывать каждый раз полный путь к файлу программы,
// работать с ней необходимо из Командной строки средств развертывания, запущенной строго с администраторскими правами 
//доступа.

/Apply-Image - Применение новых параметров образа.
-imagefile - образ из файла, заданного параметром /Imagefile
-index - Index:индекс_образа


Bcdboot.exe n:\Windows /s s:

//Команда BCDBOOT применяется в операционных системах Windows 7 и старше для создания и восстановления файлов данных
//конфигурации загрузки ОС ( BCD - Boot Configuration Data ). Средство командной строки bcdboot.exe позволяет выполнить 
//копирование в заданный раздел критических файлов загрузки и создания нового ( резервного ) хранилища данных конфигурации 
//загрузки Windows. 
/s - Необязательный параметр, определяющий букву тома, назначенную целевому системному разделу, в который копируются файлы 
//среды загрузки. По умолчанию используется системный раздел, создаваемый при стандартной установке системы 
//(небольшой раздел "Зарезервировано системой" в начале диска, которому автоматически не присвается буква).



wpeutil reboot

//Служебная программа Windows® PE (Wpeutil) — это программа командной строки, которая позволяет выполнять команды в сеансе 
//среды предустановки Windows. Например, можно завершить работу компьютера или перезапустить среду предустановки Windows,
// включить или отключить брандмауэр, задать языковые параметры и настроить сеть.
reboot - Перезапускает текущий сеанс среды предустановки Windows.

### -- Configure Networking on Just-Installed OS
New-NetIPAddress -interfacealias ethernet0 -IPAddress 192.168.3.200 -Prefixlength 24 -defaultgateway 192.168.3.2	//Создает и настраивает IP-адрес.
																						//interfacealias - Задает псевдоним сетевого интерфейса.
																						//Командлет создает IP-адрес для псевдонима.
																						//IPAddress - Указывает IPv4 или IPv6-адрес для создания.
																						//Prefixlength - Определяет длину префикса. Этот параметр определяет
																						//размер локальной подсети и также известен как маска подсети.
																						//defaultgateway - Указывает адрес IPv4 или IPv6-адрес шлюза по умолчанию
																						//для хоста. Шлюзы по умолчанию предоставляют маршрут по умолчанию
																						//для хостов TCP / IP, используемых при общении с другими узлами в 
																						//удаленных сетях.
Set-DNSClientServerAddress -interfacealias ethernet0 -ServerAddress 192.168.3.10		//Устанавливает адреса DNS-сервера, связанные с свойствами TCP / IP на интерфейсе.
																						//interfacealias - Задает дружественное имя интерфейса.
																						//serverAddress - Указывает список IP-адресов DNS-сервера для установки интерфейса.
New-NetFirewallRule -displayname "Allow All Traffic" -direction outbound -action allow	//Создает новое правило входящего или исходящего брандмауэра и добавляет правило
																						//на целевой компьютер.
																						//Указывает, что создаются только соответствующие правила брандмауэра
																						//указанного отображаемого имени. Подстановочные знаки принимаются.																					
																						//Задает локализованное имя пользователя создаваемого правила 
																						//брандмауэра. При создании правила этот параметр требуется. 
																						//Это значение параметра зависит от локали. Если объект не изменяется, 
																						//то при определенных обстоятельствах это значение параметра может
																						//измениться. При написании сценариев в многоязычных средах вместо этого
																						//следует использовать параметр Name, где значение по умолчанию - 
																						//случайное заданное значение.
																						//Примечание. Этот параметр не может быть установлен на «Все».
																						//-direction - Указывает, что создаются соответствующие правила
																						//брандмауэра в указанном направлении.
																						//Этот параметр указывает, какое направление трафика соответствует 
																						//этому правилу.
																						//Ниже указаны допустимые значения этого параметра. Входящий или исходящий.
																						//Значение по умолчанию - Inbound.
																						//-action - Указывает, что будут созданы соответствующие правила 
																						//брандмауэра для указанного действия.
																						//Этот параметр определяет действие для трафика, которое соответствует 
																						//этому правилу.
																						//Ниже указаны допустимые значения этого параметра. Разрешить или 
																						//заблокировать.
																						//- Разрешить: сетевые пакеты, соответствующие всем критериям,
																						//указанным в этом правиле, разрешены через брандмауэр. Это значение 
																						//по умолчанию.
																						//- Блок: сетевые пакеты, соответствующие всем критериям, 
																						//указанным в этом правиле, удаляются брандмауэром.
																						//Значение по умолчанию - «Разрешить».
																						//Примечание. Поле OverrideBlockRules изменяет правило allow в 
																						//правило обхода исключения.
New-NetFirewallRule -displayname "Allow All Traffic" -direction inbound -action allow	//Создает новое правило входящего или исходящего брандмауэра и добавляет правило
																						//на целевой компьютер.
																						//Указывает, что создаются только соответствующие правила брандмауэра
																						//указанного отображаемого имени. Подстановочные знаки принимаются.																					
																						//Задает локализованное имя пользователя создаваемого правила 
																						//брандмауэра. При создании правила этот параметр требуется. 
																						//Это значение параметра зависит от локали. Если объект не изменяется, 
																						//то при определенных обстоятельствах это значение параметра может
																						//измениться. При написании сценариев в многоязычных средах вместо этого
																						//следует использовать параметр Name, где значение по умолчанию - 
																						//случайное заданное значение.
																						//Примечание. Этот параметр не может быть установлен на «Все».
																						//-direction - Указывает, что создаются соответствующие правила
																						//брандмауэра в указанном направлении.
																						//Этот параметр указывает, какое направление трафика соответствует 
																						//этому правилу.
																						//Ниже указаны допустимые значения этого параметра. Входящий или исходящий.
																						//Значение по умолчанию - Inbound.
																						//-action - Указывает, что будут созданы соответствующие правила 
																						//брандмауэра для указанного действия.
																						//Этот параметр определяет действие для трафика, которое соответствует 
																						//этому правилу.
																						//Ниже указаны допустимые значения этого параметра. Разрешить или 
																						//заблокировать.
																						//- Разрешить: сетевые пакеты, соответствующие всем критериям,
																						//указанным в этом правиле, разрешены через брандмауэр. Это значение 
																						//по умолчанию.
																						//- Блок: сетевые пакеты, соответствующие всем критериям, 
																						//указанным в этом правиле, удаляются брандмауэром.
																						//Значение по умолчанию - «Разрешить».
																						//Примечание. Поле OverrideBlockRules изменяет правило allow в 
																						//правило обхода исключения.
Add-Computer -newname hyperv1 -domainname company.pri -restart							//Добавляет компьютер к домену или рабочей группе