Продвинутая Установка NixOS:
====================================================================
Продвинутый вариант установки
Когда нужно просто развернуть систему используя уже имеющийся файл конфигурации, можно поступить следующим образом:

   1) Загрузить конфигурацию в git репозиторий на один из хостингов вроде github.com или bitbucket.org
   2) В установочной системе установить пакет git
   3) Превратить каталог /etc/nixos в полноценный репозиторий git
   4) Добавить ссылку на удалённый репозиторий
   5) Затянуть содержимое удалённого репозитория
   6) Установить систему с использованием конфига из репозитория

Такой вариант может показаться слишком сложным, но он очень удобен, ведь теперь конфигурация находится в надёжном месте и может быть легко развёрнута на любой машине. Вы можете, к примеру, создать отдельные ветки для каждого типа конфигурации и вытягивать нужную на каждую из ваших машин. Также удобно объединять изменения одних веток с другими.
====================================================================
Итак, делаем следующее:

# Устанавливаем пакет git
[root@nixos:~]$ nix-env -i git
 
# Переходим в каталог с конфигом
[root@nixos:~]$ cd /mnt/etc/nixos
 
# Создаём репозиторий
[root@nixos:/mnt/etc/nixos]$ git init
Initialized empty Git repository in /mnt/etc/nixos/.git/
 
# Добавляем ссылку на внешний апстрим
[root@nixos:/mnt/etc/nixos]$ git remote add origin git@bitbucket.org:kayo/nixos-config
 
# Генерируем rsa ключи для доступа к git
# если репозиторий публичный и доступен по HTTP
# можно обойтись и без этого
[root@nixos:/mnt/etc/nixos]$ ssh-keygen
 
# Передаём публичный ключ хостеру репозитория
# нам потребуется доступ на чтение по нему
# обычно это называют ключи для деплоя
[root@nixos:/mnt/etc/nixos]$ cat ~/.ssh/id_rsa.pub
 
# Не забудем потом скопировать ключи в корневую
# файловую систему устанавливаемой системы
 
# Переименовываем имеющийся конфиг
# чтобы избежать конфликта
[root@nixos:/mnt/etc/nixos]$ mv configuration.nix configuration.nix~orig
 
# Затягиваем контент из внешнего репозитория
[root@nixos:/mnt/etc/nixos]$ git pull origin master
From bitbucket.org:kayo/nixos-config
 * branch            master     -> FETCH_HEAD
 
# Устанавливаем в качестве апстрима удалённую ветку master
[root@nixos:/mnt/etc/nixos]$ git branch --set-upstream-to=origin/master master
Branch master set up to track remote branch master from origin.
 
# Запускаем установку
[root@nixos:/mnt/etc/nixos]$ nixos-install
===============================================
