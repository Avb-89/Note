Установка и настройка postgresql (в Ubuntu):
[REC] - Рекомендации
[INFO] - Информация на случай если забудешь
=================================================== Необходимое ПО =====================================================
        Обязательно
        -    tar, gzip/bzip2, GNU make, компилятор Си (C89)
        Используются, но можно отключить
        -   библиотеки GNU Readline, zlib
        -   Дополнительно языки программирования Perl, Python, Tcl для использования PL/Perl,
        -   PL/Python, PL/TclKerberos, OpenSSL, OpenLDAP, PAM для аутентификации и шифрования
        -   библиотека ICU для кроссплатформенной поддержки UNICODE
        -   Отдельные инструменты при сборке из репозитория git

        Также ля сборки требуется ряд программ и утилит.
        -   Библиотека readline дает возможность редактировать командную строку,
        пользоваться историей команд и автодополнением (необязательно).
        -   Библиотека zlib используется для сжатия архивов pg_dump.

По адресу https://www.postgresql.org/ftp/source/v13.7/ доступен исходный код версии 13.7 в двух вариантах (gzip и bzip2)
========================================================================================================================

Подготовка системы:
    Установка зависисмостей:
        tar и gzip уже пристуствует в системе
        $ sudo apt update
        $ sudo apt install make build-essential

Установка сервера:

    $ wget https://ftp.postgresql.org/pub/source/v13.7/postgresql-13.7.tar.gz
    $ tar xzf /home/student/postgresql-13.7.tar.gz
    $ cd /home/student/postgresql-13.7

[REC] Для промышленного использования сервер лучше устанавливать в каталог, доступный на запись только суперпользователю

    $ sudo ./configure --prefix=/opt/pgsql13 --with-pgport=5555

         [INFO]   --prefix — каталог установки, по умолчанию /usr/local/pgsql;
         [INFO]   --enable-debug — для включения отладочной информации.
         [INFO]   порт 5432 по умолчанию
         [INFO]   Если требуется повторно выполнить конфигурацию, например с другими параметрами,
                  то предварительно нужно очистить результаты предыдущего запуска:

                    $ make distclean
    Собираем сервер:

        $ sudo make

    Теперь устанавливаем сервер.

        $ sudo make install

    Для сборки расширений нужно зайти в каталог ~/postgresql-13.7/contrib:

        $ cd contrib/
        $ sudo make
        $ sudo make install

    [INFO] Если бы собирали сервер с расширениями и документацией (make world),
            то можно было бы установить все вместе командой
            $ sudo make install-world


Создание кластера

    Утилита
        initdb
    Особенности:
    - новый кластер баз данных не может принадлежать суперпользователю
    - PGDATA — удобная переменная для каталога кластера
    файлы конфигурации создаются в  каталоге PGDATA
    - желательно включить расчет контрольных сумм для страниц с данными

[REC] Для промышленного использования владельцем каталога обычно назначают отдельного пользователя ОС

       $ sudo mkdir /var/pgsql13/data
       $ export PGDATA=/var/pgsql13/data
       $ export PATH=/opt/pgsql13/bin:$PATH

Для инициализации кластера базы данных используется утилита initdb

       # chown student /var/pgsql13/data && chown student /var/pgsql13
       $ initdb -U postgres -k -D /var/pgsql13/data
            [INFO] В ключе -U можно указать имя суперпользователя СУБД.
                Если его не задать, то используется имя пользователя ОС, в нашем случае student.
                Обычно таким пользователем является postgres, так что зададим это имя явно.
            [INFO] Ключ -k включает подсчет контрольных суммы страниц, что позволяет своевременно обнаруживать повреждение данных.
                    Если переменная PGDATA не установлена, то следует в ключе -D указать каталог для данных.
                    В нашем случае этот ключ можно было бы не указывать

Управление сервером:

    Утилита
        pg_ctl
    Основные задачи
        - запуск
        - останов
        - получение статуса сервера
        - обновление параметров конфигурации
        - переключение на реплику

[REC] Запускать pg_ctl следует от имени владельца кластера баз данных

    $ sudo mkdir /var/log/pglog
    $ sudo chown student /var/log/pglog/

    $ pg_ctl start -l /var/log/pglog/logfile
       [INFO] В ключе -l укажем файл журнала сообщений сервера.
       [INFO] Ключ -D опускаем, поскольку задана переменная PGDATA.


Проверить работоспособность можно так:
    $ psql -U postgres -p 5555 -c 'SELECT now();'
Это должно выдать текущее время и дату.



